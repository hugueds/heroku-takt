<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="style.css" rel="stylesheet" />
    <link href="switch.css" rel="stylesheet" />
    <title>INTERTRAVAMENTOS</title>
</head>

<body>

    <div class="buttons-container"></div>

    <script src='../js/jquery.min.js'></script>
    <script src="../js/socket.io.js"></script>

    <script>

        var io = io();

        var stations = ["110", "111", "112", "113", "114", "115",
            "121", "122", "123", "124",
            "21", "22", "23", "24",
            "311", "312",
            "313", "321", "322",
            "41", "42", "43", "44",
            "51", "52", "53", "54"];

        var interlocks = { ML1: [], ML2: [] }

        $(document).ready(function (e) {
            createButtons();
            io.emit('get-interlock');
        });

        setInterval(function () {
            io.emit('get-interlock');
        }, 1000);

        io.on('interlock', function (data) {
            interlocks.ML1 = data[0];
            interlocks.ML2 = data[1];
            updateInterlockButtons();
        });


        function createButtons() {
            var buttons = []
            stations.map(function (s, i, a) {
                var btn = button(a[i]);
                btn.children('.slider').on('click', function (e) {
                    var id = $(this).parent()[0].id;
                    io.emit('update-interlock', id);
                });
                buttons.push(btn);
            });
            $('.buttons-container').append(buttons);
        }

        function button(id) {
            return $('<label class="switch" id="' + id + '">' +
                '<input type="checkbox"/>' +
                '<div class="slider round"></div>' +
                '</label>');
        }

        function updateInterlockButtons() {
            interlocks.ML1.map(updateButtonStatus);
            interlocks.ML2.map(updateButtonStatus);
        }

        function updateButtonStatus(interlock) {
            var input = $('#' + interlock.station).children('input');
            if (interlock.enabled) {
                input.attr('checked', 'checked');
            } else {
                input.removeAttr('checked');
            }
        }



    </script>


</body>

</html>